{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import{Link}from\"react-router-dom\";import Price from\"./ui/Price\";import Ratings from\"./ui/Ratings\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const Book=_ref=>{let{book}=_ref;const[img,setImg]=useState(null);const[imgError,setImgError]=useState(false);const mountedRef=useRef(true);// Initial state is true\nuseEffect(()=>{const image=new Image();image.src=book.url;image.onload=()=>{if(mountedRef.current){setTimeout(()=>{setImg(image);},300);// Delay added to show skeleton effect\n}};image.onerror=()=>{if(mountedRef.current){setImgError(true);}};// Cleanup on component unmount\nreturn()=>{mountedRef.current=false;// Set to false when component is unmounted\n};},[book.url]);return/*#__PURE__*/_jsx(\"div\",{className:\"book\",children:imgError?/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:\"Failed to load image\"}):!img?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"book__img--skeleton\"}),/*#__PURE__*/_jsx(\"div\",{className:\"skeleton book__title--skeleton\"}),/*#__PURE__*/_jsx(\"div\",{className:\"skeleton book__rating--skeleton\"}),/*#__PURE__*/_jsx(\"div\",{className:\"skeleton book__price--skeleton\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:\"/books/\".concat(book.id),children:/*#__PURE__*/_jsx(\"figure\",{className:\"book__img--wrapper\",children:/*#__PURE__*/_jsx(\"img\",{className:\"book__img\",src:img.src,alt:book.title})})}),/*#__PURE__*/_jsx(\"div\",{className:\"book__title\",children:/*#__PURE__*/_jsx(Link,{to:\"/books/\".concat(book.id),className:\"book__title--link\",children:book.title})}),/*#__PURE__*/_jsx(Ratings,{rating:book.rating}),/*#__PURE__*/_jsx(Price,{originalPrice:book.originalPrice,salePrice:book.salePrice})]})});};export default Book;","map":{"version":3,"names":["React","useState","useEffect","useRef","Link","Price","Ratings","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Book","_ref","book","img","setImg","imgError","setImgError","mountedRef","image","Image","src","url","onload","current","setTimeout","onerror","className","children","to","concat","id","alt","title","rating","originalPrice","salePrice"],"sources":["/Users/pharaohmak/Developer/portfolio/Frontend Simplified/projects/React-My-Library/src/components/Book.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport Price from \"./ui/Price\";\nimport Ratings from \"./ui/Ratings\";\n\nconst Book = ({ book }) => {\n  const [img, setImg] = useState(null);\n  const [imgError, setImgError] = useState(false);\n  const mountedRef = useRef(true); // Initial state is true\n\n  useEffect(() => {\n    const image = new Image();\n    image.src = book.url;\n\n    image.onload = () => {\n      if (mountedRef.current) {\n        setTimeout(() => {\n          setImg(image);\n        }, 300); // Delay added to show skeleton effect\n      }\n    };\n\n    image.onerror = () => {\n      if (mountedRef.current) {\n        setImgError(true);\n      }\n    };\n\n    // Cleanup on component unmount\n    return () => {\n      mountedRef.current = false; // Set to false when component is unmounted\n    };\n  }, [book.url]);\n\n  return (\n    <div className=\"book\">\n      {imgError ? (\n        <div className=\"error-message\">Failed to load image</div>\n      ) : !img ? (\n        <>\n          {/* Skeleton loading placeholders */}\n          <div className=\"book__img--skeleton\"></div>\n          <div className=\"skeleton book__title--skeleton\"></div>\n          <div className=\"skeleton book__rating--skeleton\"></div>\n          <div className=\"skeleton book__price--skeleton\"></div>\n        </>\n      ) : (\n        <>\n          {/* Once image is loaded, show book details */}\n          <Link to={`/books/${book.id}`}>\n            <figure className=\"book__img--wrapper\">\n              <img className=\"book__img\" src={img.src} alt={book.title} />\n            </figure>\n          </Link>\n          <div className=\"book__title\">\n            <Link to={`/books/${book.id}`} className=\"book__title--link\">\n              {book.title}\n            </Link>\n          </div>\n          <Ratings rating={book.rating} />\n          <Price\n            originalPrice={book.originalPrice}\n            salePrice={book.salePrice}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default Book;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}